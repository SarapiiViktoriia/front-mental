'use strict';
var DOCUMENT_MODE = require('./html').DOCUMENT_MODE;
var VALID_DOCTYPE_NAME = 'html',
    QUIRKS_MODE_SYSTEM_ID = 'http:
    QUIRKS_MODE_PUBLIC_ID_PREFIXES = [
        '+
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
        '-
    ],
    QUIRKS_MODE_NO_SYSTEM_ID_PUBLIC_ID_PREFIXES = QUIRKS_MODE_PUBLIC_ID_PREFIXES.concat([
        '-
        '-
    ]),
    QUIRKS_MODE_PUBLIC_IDS = [
        '-
        '-/w3c/dtd html 4.0 transitional/en',
        'html'
    ],
    LIMITED_QUIRKS_PUBLIC_ID_PREFIXES = [
        '-
        '-
    ],
    LIMITED_QUIRKS_WITH_SYSTEM_ID_PUBLIC_ID_PREFIXES = LIMITED_QUIRKS_PUBLIC_ID_PREFIXES.concat([
        '-
        '-
    ]);
function enquoteDoctypeId(id) {
    var quote = id.indexOf('"') !== -1 ? '\'' : '"';
    return quote + id + quote;
}
function hasPrefix(publicId, prefixes) {
    for (var i = 0; i < prefixes.length; i++) {
        if (publicId.indexOf(prefixes[i]) === 0)
            return true;
    }
    return false;
}
exports.getDocumentMode = function (name, publicId, systemId) {
    if (name !== VALID_DOCTYPE_NAME)
        return DOCUMENT_MODE.QUIRKS;
    if (systemId && systemId.toLowerCase() === QUIRKS_MODE_SYSTEM_ID)
        return DOCUMENT_MODE.QUIRKS;
    if (publicId !== null) {
        publicId = publicId.toLowerCase();
        if (QUIRKS_MODE_PUBLIC_IDS.indexOf(publicId) > -1)
            return DOCUMENT_MODE.QUIRKS;
        var prefixes = systemId === null ? QUIRKS_MODE_NO_SYSTEM_ID_PUBLIC_ID_PREFIXES : QUIRKS_MODE_PUBLIC_ID_PREFIXES;
        if (hasPrefix(publicId, prefixes))
            return DOCUMENT_MODE.QUIRKS;
        prefixes = systemId === null ? LIMITED_QUIRKS_PUBLIC_ID_PREFIXES : LIMITED_QUIRKS_WITH_SYSTEM_ID_PUBLIC_ID_PREFIXES;
        if (hasPrefix(publicId, prefixes))
            return DOCUMENT_MODE.LIMITED_QUIRKS;
    }
    return DOCUMENT_MODE.NO_QUIRKS;
};
exports.serializeContent = function (name, publicId, systemId) {
    var str = '!DOCTYPE ';
    if (name)
        str += name;
    if (publicId !== null)
        str += ' PUBLIC ' + enquoteDoctypeId(publicId);
    else if (systemId !== null)
        str += ' SYSTEM';
    if (systemId !== null)
        str += ' ' + enquoteDoctypeId(systemId);
    return str;
};
